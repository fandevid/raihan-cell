<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Konter Raihan Cell" />
    <title>Selamat Datang - Raihan Cell</title>
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@100;200;300;400;500;600;700;800;900&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css"
    />

    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/home.css" />
  </head>
  <body>
    <header>
      <nav class="navbar shadow">
        <div class="container">
          <a
            href="#Id2"
            class="nav-item p-1 nav-link"
            role="button"
            data-bs-toggle="offcanvas"
            aria-controls="Id2"
            ><i class="bx bx-fw bx-menu"></i
          ></a>
          <a href="#" class="navbar-brand">Raihan Cell</a>
          <button class="btn btn-sm btn-secondary p-1">
            <i class="bx bx-fw bx-search-alt"></i>
          </button>
        </div>
        <!-- <div style="height: 1rem; width: 100%"></div> -->
      </nav>

      <div
        class="offcanvas offcanvas-start"
        data-bs-backdrop="static"
        tabindex="-1"
        id="Id2"
        aria-labelledby="staticBackdropLabel"
      >
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="staticBackdropLabel">Raihan Cell</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="offcanvas"
            aria-label="Close"
          ></button>
        </div>
        <div class="offcanvas-body">
          <div>
            Mohon maaf, fitur ini belum tersedia. Silahkan kirim masukan atau
            saran ke
            <a
              href="//api.whatsapp.com/send?phone=6282323864176"
              target="_blank"
              >Whatsapp Kami.</a
            >
          </div>
        </div>
      </div>
    </header>

    <main class="mt-3">
      <section>
        <div class="container">
          <h3 class="text-center mb-3">Tambah Produk</h3>
          <form
            name="form_add_product"
            autocomplete="off"
            enctype="multipart/form-data"
          >
            <div class="form-group mb-3">
              <label class="form-label">Nama Produk</label>
              <input
                required
                type="text"
                name="name"
                class="form-control"
                pattern="[a-zA-Z0-9., ]*"
                placeholder="Contoh Nama Produk"
              />
            </div>
            <div class="from-group mb-3">
              <label class="form-label">Kategory</label>
              <input
                type="text"
                name="ctg"
                pattern="[a-zA-Z ]*"
                class="form-control"
                placeholder="Stiker, voucher, game, dll"
                list="list-kategori"
              />
              <datalist id="list-kategori">
                <option value="Stiker"></option>
                <option value="Voucher"></option>
                <option value="Token Listrik"></option>
                <option value="TopUp"></option>
              </datalist>
            </div>
            <div class="form-group mb-3">
              <label class="form-label">Harga</label>
              <input
                required
                type="number"
                name="price"
                class="form-control"
                min="1"
                max="1000000"
                placeholder="Rp....."
              />
            </div>
            <div class="form-group mb-3">
              <label class="form-label"> Deskripsi </label>
              <textarea
                class="form-control"
                name="desc"
                rows="7"
                placeholder="Deskripsi produk "
              ></textarea>
            </div>
            <div class="form-group mb-3">
              <label class="form-label"> Foto Produk</label>
              <input
                required
                type="file"
                name="image"
                class="form-control"
                accept="image/*"
              />
              <small class="form-control-plaintext"
                >Dimensi foto 1:1 (kotak)</small
              >
            </div>
            <button type="submit" class="btn btn-primary my-3">
              Tambahkan
            </button>
          </form>
        </div>
      </section>
    </main>

    <!-- <footer>
      <div
        class="footer d-flex justify-content-center align-items-center text-light p-3"
        style="background-color: var(--primer) !important"
      >
        <div>
          Created with <i class="bx bxs-heart text-danger bx-tada bx-fw"></i>by
          <a href="https://github.com/fandevid" class="text-light">M. Irfan</a>
        </div>
      </div>
    </footer> -->

    <script src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-analytics.js";
      import {
        getFirestore,
        collection,
        addDoc,
      } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-firestore.js";
      import {
        getStorage,
        ref,
        uploadBytes,
      } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-storage.js";

      const firebaseConfig = {
        apiKey: "AIzaSyC9to2YMfRoibY4wZ3wVOqrRQasyh5blnk",
        authDomain: "raihan-cell.firebaseapp.com",
        projectId: "raihan-cell",
        storageBucket: "raihan-cell.appspot.com",
        messagingSenderId: "584438130477",
        appId: "1:584438130477:web:df0c0b5431a9cd267fd5a4",
        measurementId: "G-F48E185JWB",
        storageBucket: "gs://raihan-cell.appspot.com",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = getFirestore(app);
      const storage = getStorage(app);

      const formAddProduct = document.forms["form_add_product"];
      formAddProduct.onsubmit = handler;

      async function handler(e) {
        e.preventDefault();
        const form = new FormData(e.target);

        const image = form.get("image");
        console.log(image);
        // Image Validation
        if (image.size > 1048576) {
          Swal.fire({
            icon: "warning",
            titleText: "Ukuran File Terlalu Besar",
            showConfirmButton: false,
          });
          return;
        }

        const filename = `${new Date().getTime()}.${image.name
          .split(".")
          .pop()}`;

        const data = {
          created_at: new Date(),
          name: form.get("name"),
          desc: form.get("desc"),
          ctg: form.get("ctg"),
          price: Number(form.get("price")),
          image_url: `https://firebasestorage.googleapis.com/v0/b/raihan-cell.appspot.com/o/product%2F${filename}?alt=media`,
        };

        // Upload Image File
        const storageRef = ref(storage, "product/" + filename);
        await uploadBytes(storageRef, image).then((snapshot) => {});

        // Add to Firestore Database
        try {
          const docRef = await addDoc(collection(db, "product"), data);
          console.log("Document written with ID: ", docRef.id);
          e.target.reset();
          Swal.fire({
            icon: "success",
            titleText: "Berhasil",
            text: "Anda telah berhasil menambahkan produk baru.",
            showCancelButton: true,
            cancelButtonText: "Keluar",
            confirmButtonText: "Lihat Produk",
          }).then((result) => {
            if (!result.isConfirmed) return;
            document.location.href = document.location.origin;
          });
        } catch (e) {
          Swal.fire({
            icon: "error",
            titleText: "Terjadi Kesalahan",
            text: "Mohon maaf, silahkan coba kembali nanti atau hubungi pengembang aplikasi.",
          });
          // console.error("Error adding document: ", e.errorMessage);
        }
      }
    </script>
  </body>
</html>
